/*1300397219,169776067*/

if (window.CavalryLogger) { CavalryLogger.start_js(["A5+Dh"]); }

WindowComm={_callbacks:{},makeHandler:function(a,c){c=c||'opener';var b='f'+(Math.random()*(1<<30)).toString(16).replace('.','');WindowComm._callbacks[b]=a;return new URI('/connect/window_comm.php').setQueryData({_id:b,_relation:c}).getQualifiedURI().toString();},_recv:function(b){var a=new URI(b).getQueryData();WindowComm._callbacks[a._id](a);}};
function Rect(e,d,a,c,b){if(this===window){if(e instanceof Rect)return e;if(e instanceof Vector2)return new Rect(e.y,e.x,e.y,e.x,e.domain);return Rect.getElementBounds($(e));}copy_properties(this,{t:e,r:d,b:a,l:c,domain:b||'pure'});}copy_properties(Rect.prototype,{w:function(){return this.r-this.l;},h:function(){return this.b-this.t;},toString:function(){return '(('+this.l+', '+this.t+'), ('+this.r+', '+this.b+'))';},contains:function(b){b=Rect(b).convertTo(this.domain);var a=this;return (a.l<=b.l&&a.r>=b.r&&a.t<=b.t&&a.b>=b.b);},add:function(c,d){if(arguments.length==1){if(c.domain!='pure')c=c.convertTo(this.domain);return this.add(c.x,c.y);}var a=parseFloat(c);var b=parseFloat(d);return new Rect(this.t+b,this.r+a,this.b+b,this.l+a,this.domain);},sub:function(a,b){if(arguments.length==1){return this.add(a.mul(-1));}else return this.add(-a,-b);},boundWithin:function(a){var b=0,c=0;if(this.l<a.l){b=a.l-this.l;}else if(this.r>a.r)b=a.r-this.r;if(this.t<a.t){c=a.t-this.t;}else if(this.b>a.b)c=a.b-this.b;return this.add(b,c);},getPositionVector:function(){return new Vector2(this.l,this.t,this.domain);},getDimensionVector:function(){return new Vector2(this.w(),this.h(),'pure');},convertTo:function(a){if(this.domain==a)return this;if(a=='pure')return new Rect(this.t,this.r,this.b,this.l,'pure');if(this.domain=='pure')return new Rect(0,0,0,0);var b=new Vector2(this.l,this.t,this.domain).convertTo(a);return new Rect(b.y,b.x+this.w(),b.y+this.h(),b.x,a);}});copy_properties(Rect,{newFromVectors:function(b,a){return new Rect(b.y,b.x+a.x,b.y+a.y,b.x,b.domain);},getElementBounds:function(a){return Rect.newFromVectors(Vector2.getElementPosition(a),Vector2.getElementDimensions(a));},getViewportBounds:function(){return Rect.newFromVectors(Vector2.getScrollPosition(),Vector2.getViewportDimensions());}});
ConnectLogin={init:function(a){this.appID=a.appID;this.oneClick=a.oneClick;XD.init(a);},login:function(a,c,b){if(this.oneClick&&!c){this._oneClick(a);}else this._openPopup(a,c,b);},logout:function(){XD.send({type:'logout'});},_oneClick:function(a){new AsyncRequest().setURI('/ajax/api/tos.php').setData({app_id:this.appID,grant_perm:1}).setHandler(function(b){ConnectLogin._refreshLoginStatus();a&&a();}).send();},_openPopup:function(c,e,d){d=d||{};var b=WindowComm.makeHandler(function(h){ConnectLogin._closePopup();if(ConnectLogin.appID)ConnectLogin._refreshLoginStatus();c&&c();}),a=WindowComm.makeHandler(function(h){ConnectLogin._closePopup();}),g=new URI('/login.php');g.setQueryData({api_key:this.appID,next:b,channel_url:a,cancel_url:a,req_perms:e,v:'1.0',fbconnect:1,display:'popup'});g.addQueryData(d);var f=this._getSize(d);this._popup=PopupResizer.open(g.toString(),f.height,f.width);},_closePopup:function(){if(this._popup){this._popup.close();this._popup=null;}},_refreshLoginStatus:function(){XD.send({type:'refreshLoginStatus'});},_getSize:function(a){if(a.social_plugin=='registration'){return {width:640,height:370};}else return {width:610,height:280};}};
FBCommentServer={serverStarted:true,init:function(a){CSS.setClass($(a.commentsID).parentNode,'mu-connect-disable-logout');this._notifyAddComment=a.notify;ConnectLogin.init(a);XD.init({channelUrl:a.channelUrl,hideOverflow:true,autoResize:true});},showConnect:function(){ConnectLogin.login();},setupConnect:function(a,b){if(Env.user){a.defer();}else b.defer();},addComment:function(a){if(this._notifyAddComment)XD.send({type:'addComment',comments:a});}};
function UntrustedLink(a,d,b,c){this.dom=a;this.url=a.href;this.hash=d;this.func_get_params=c||function(){return {};};Event.listen(this.dom,'click',this.onclick.bind(this));Event.listen(this.dom,'mousedown',this.onmousedown.bind(this));Event.listen(this.dom,'mouseup',this.onmouseup.bind(this));Event.listen(this.dom,'mouseout',this.onmouseout.bind(this));this.onmousedown($E(b));}UntrustedLink.bootstrap=function(a,d,b,c){if(a.__untrusted)return;a.__untrusted=true;new UntrustedLink(a,d,b,c);};UntrustedLink.prototype.getRewrittenURI=function(){var a=copy_properties({u:this.url,h:this.hash},this.func_get_params(this.dom));return new URI('/l.php').setQueryData(a).setSubdomain('www');};UntrustedLink.prototype.onclick=function(){(function(){this.dom.href=this.url;}).bind(this).defer(100);this.dom.href=this.getRewrittenURI();};UntrustedLink.prototype.onmousedown=function(a){if(a.button==2)this.dom.href=this.getRewrittenURI();};UntrustedLink.prototype.onmouseup=function(){this.dom.href=this.getRewrittenURI();};UntrustedLink.prototype.onmouseout=function(){this.dom.href=this.url;};
var LiveTimer={restart:function(a){this.serverTime=a;this.localStartTime=new Date().getTime()/1000;this.updateTimeStamps();},updateTimeStamps:function(){LiveTimer.timestamps=DOM.scry(document.body,'abbr.timestamp');LiveTimer.startLoop(20000);},addTimeStamps:function(a){if(!a||!LiveTimer.timestamps)return;var c=DOM.scry(a,'abbr.timestamp');for(var b=0;b<c.length;++b)LiveTimer.timestamps.push(c[b]);LiveTimer.startLoop(0);},startLoop:function(a){this.stop();this.timeout=setTimeout(function(){LiveTimer.loop();},a);},stop:function(){clearTimeout(this.timeout);},updateNode:function(a,b){LiveTimer.updateNode=(ua.ie()<7)?function(c,d){c.nextSibling.nodeValue=d;}:function(c,d){c.firstChild.nodeValue=d;};LiveTimer.updateNode(a,b);},loop:function(d){if(d)LiveTimer.updateTimeStamps();var c=Math.floor(new Date().getTime()/1000-LiveTimer.localStartTime);var a=-1;LiveTimer.timestamps&&LiveTimer.timestamps.each(function(g){var f=+new Date(g.getAttribute('data-date'))/1000;var e=LiveTimer.renderRelativeTime(LiveTimer.serverTime+c,f);if(e.text)LiveTimer.updateNode(g,e.text);if(e.next!=-1&&(e.next<a||a==-1))a=e.next;});if(a!=-1){var b=Math.max(20000,a*1000);LiveTimer.timeout=setTimeout(function(){LiveTimer.loop();},b);}},renderRelativeTime:function(c,d){var e={text:"",next:-1};if(c-d>(12*3600)||(new Date(c*1000).getDay()!=new Date(d*1000).getDay()))return e;var f=c-d,b=Math.floor(f/60),a=Math.floor(b/60);if(b<1){e.text=_tx("a few seconds ago");e.next=60-f%60;return e;}if(a<1){if(b==1){e.text=_tx("about a minute ago");}else e.text=_tx("{number} minutes ago",{number:b});e.next=60-f%60;return e;}if(a!=11)e.next=3600-f%3600;if(a==1){e.text=_tx("about an hour ago");return e;}e.text=_tx("{number} hours ago",{number:a});return e;}};
function ConnectSocialWidget(a,b){ConnectSocialWidget.setInstance(b,this);ConnectSocialWidget.delayUntilDisplayed(function(){this.initializeObject.call(this,a,b);}.bind(this));}copy_properties(ConnectSocialWidget,{OPT_IN_FACEBOOK_APP_ID:'127760087237610',TYPE_ACTIVITY:'A',TYPE_RECOMMENDATIONS:'R',TYPE_POLL:'P',TYPE_LIKEBOX:'L',instances:{},setInstance:function(b,a){ConnectSocialWidget.instances[b]=a;},getInstance:function(a){return ConnectSocialWidget.instances[a];},popups:{},login:function(a,b){ConnectSocialWidget.popups[b]={popup:PlatformOptInPopup.open('login','opt.in')};},aDelayedFunctions:[],delayUntilDisplayed:function(a){ConnectSocialWidget.aDelayedFunctions.push(a);if(ConnectSocialWidget.aDelayedFunctions.length===1){if(!ConnectSocialWidget.ndTestDim){var b=document.createElement('div'),c={position:'absolute',width:'1px',height:'1px',visibility:'hidden',overflow:'hidden',top:'0px'};for(var d in c)if(typeof c[d]==='string')CSS.setStyle(b,d,c[d]);document.body.appendChild(b);ConnectSocialWidget.ndTestDim=b;}ConnectSocialWidget.testForDisplay();}},testForDisplay:function(){var a=Vector2.getElementDimensions(ConnectSocialWidget.ndTestDim).y;if(a!==0){ConnectSocialWidget.aDelayedFunctions.forEach(function(b){b();});ConnectSocialWidget.aDelayedFunctions=[];}else ConnectSocialWidget.testForDisplay.defer(100);},listenForLogin:function(){if(!ConnectSocialWidget.listenerAttached){Arbiter.subscribe('platform/socialplugins/login',function(a){if(a.user!==Env.user)document.location.reload();});ConnectSocialWidget.listenerAttached=true;}}});copy_properties(ConnectSocialWidget.prototype,{initializeObject:function(e,g){var d=DOM.scry(document.body,e.sOverflowContainerSelector)[0],c=DOM.scry(d,'.fbConnectWidgetFooter')[0],a=c?Vector2.getElementDimensions(c).y:0,f=e.sOverflowItemsSelector,b=DOM.scry(document.body,e.sStreamContainerSelector)[0];this.fRemoveOverflowElements=this.removeOverflowElements.bind(this,d,b,f,-a);copy_properties(this,{bInitialized:true,sWidgetId:g,iFooterHeight:a,ndTop:d,ndFooter:c,ndContentContainer:b,oQueryParams:new URI(window.location.href).getQueryData(),bComboMode:e.bComboMode,sOverflowItemsSelector:f});copy_properties(this.oQueryParams,{post_form_id:Env.post_form_id,user:Env.user});this.fRemoveOverflowElements();CSS.setStyle(b,'visibility','visible');animation(b).from('opacity',0).to('opacity',1).duration(200).go();ConnectSocialWidget.listenForLogin();new ClickThroughMonitor({ndTop:this.ndContentContainer,fValidateLink:this.getElementTop.bind(this),fGetMonitorData:function(h){var i={site:this.oQueryParams.site,type:this.getLinkType(),plugin:this.getPluginType(),social:(DOM.scry(h,'^div.fbSocial').length>0),pos:this.getItemPosition(this.getElementTop(h)),signature:this.getItemSignature(this.getElementTop(h))};if(this.oQueryParams.api_key)i.api_key=this.oQueryParams.api_key;return i;}.bind(this)});},getElementTop:function(b){var a=DOM.scry(b,'^'+this.sOverflowItemsSelector);return a[0];},getItemPosition:function(d){var a=DOM.scry(this.ndContentContainer,this.sOverflowItemsSelector),c=a.length,b=a.indexOf(d)+1;return b+'/'+c;},getItemSignature:function(c){var a=c.className.split(' ');for(var b=0;b<a.length;b++)if(a[b].startsWith("RES_"))return a[b].substring(4);return '';},removeOverflowElements:function(h,g,i,d,e){var f,a=i?DOM.scry(g,i):$A(g.childNodes);if(!e){var d=d||0,b=Vector2.getElementDimensions(h).y+d,c=Vector2.getElementPosition(h).y;e=b+c;}while(a.length>0&&(f=$(a.pop()))&&(Vector2.getElementDimensions(f).y+Vector2.getElementPosition(f).y)>e)DOM.remove(f);},login:function(){ConnectSocialWidget.login(this.appID,this.sWidgetId);},toggleLogin:function(){DOM.scry(this.ndTop,'.fbToggleLogin').forEach(function(a){CSS.toggle(a);});this.fRemoveOverflowElements();}});function ActivityWidget(a,b){this.parent.construct(this,a,b);}ActivityWidget.extend('ConnectSocialWidget');ActivityWidget.ENDPOINT='/ajax/connect/activity_widget.php';ActivityWidget.REQUEST_INTERVAL=15*1000;ActivityWidget.ACTIVITY_HEIGHT=45;ActivityWidget.MAX_INTERVAL=30;ActivityWidget.MAX_ITEMS=24;copy_properties(ActivityWidget.prototype,{initializeObject:function(a,b){this.parent.initializeObject.call(this,a,b);copy_properties(this,{responseHandler:function(c){ConnectSocialWidget.delayUntilDisplayed(function(){this.onResponse(c);}.bind(this));}.bind(this),scheduleHandler:function(){ConnectSocialWidget.delayUntilDisplayed(function(){this.launchAsyncRequest().scheduleRequest();}.bind(this));}.bind(this),iDecay:0,iInterval:1,sRecommendationsChild:a.sRecommendationsChild,aEventHanlders:[Event.listen(document.body,'mouseover',this._onMouseOver.bind(this))]});this.oQueryParams.nb_activities=Math.min(ActivityWidget.MAX_ITEMS,Math.round((this.oQueryParams.height||300)/ActivityWidget.ACTIVITY_HEIGHT));this.oQueryParams.newest=a.iNewestStoryTime||0;this.scheduleRequest();},getLinkType:function(){return ConnectSocialWidget.TYPE_ACTIVITY;},getPluginType:function(){return ConnectSocialWidget.TYPE_ACTIVITY;},removeOverflowElements:function(){if(this.bComboMode&&!this.bFirstRound){this.bFirstRound=true;var d=Vector2.getElementPosition(this.ndTop).y,b=Vector2.getElementDimensions(document.body).y-(d+this.iFooterHeight),c=Math.round(b/2),a=$A(arguments);a[a.length]=c;ConnectSocialWidget.prototype.removeOverflowElements.apply(this,a);}else ConnectSocialWidget.prototype.removeOverflowElements.apply(this,arguments);},launchAsyncRequest:function(){if(window.LiveTimer){LiveTimer.timestamps=LiveTimer.timestamps||[];LiveTimer.startLoop(0);}new AsyncRequest().setURI(ActivityWidget.ENDPOINT).setData(this.oQueryParams).setReadOnly(true).setErrorHandler(function(){}).setHandler(this.responseHandler).setMethod('GET').send();return this;},onResponse:function(f){var e=f.getPayload();if(e&&e.html&&e.iNewestStoryTime>this.oQueryParams.newest){if(this.oQueryParams.newest===0){var c=this.getEmptyMessage();if(c)DOM.remove(c);}var d=HTML(e.html).getNodes()[0],a=[];var b=function(l){var j=DOM.scry(d,l)[0];if(j.childNodes.length===0)return;j.className="";var k=DOM.scry(this.ndContentContainer,l)[0];if(CSS.hasClass(k,'hidden_elem'))return;DOM.prependContent(k,j);CSS.setStyle(j,'opacity',0);ConnectSocialWidget.prototype.removeOverflowElements(this.ndTop,this.ndActivity,'div.fbActivity',-this.iFooterHeight);if(j.childNodes.length===0){DOM.remove(j);return;}var h=Vector2.getElementDimensions(j),g=$A(j.childNodes);var i=function(){DOM.prependContent(k,g);DOM.remove(j);this.fRemoveOverflowElements();if(this.sRecommendationsChild)ConnectSocialWidget.getInstance(this.sRecommendationsChild).showRecommendationsSeparator().fRemoveOverflowElements();}.bind(this);a.push(animation(j).from('height',0).to('height',h.y).from('opacity',0).to('opacity',1).blind().ondone(i).duration(400).ease());}.bind(this);b('div.fbFriendsActivity');a.forEach(function(g){g.go();});this.oQueryParams.newest=e.iNewestStoryTime+1;}},scheduleRequest:function(){var a=this.iInterval+this.iDecay;this.iDecay=this.iInterval;this.iInterval=a;this.oLastTimeout=setTimeout(this.scheduleHandler,ActivityWidget.REQUEST_INTERVAL+a*1000);},_onMouseOver:function(){var a=this.iInterval;this.iDecay=0;this.iInterval=1;if(a>ActivityWidget.MAX_INTERVAL){clearTimeout(this.oLastTimeout);this.scheduleRequest();}},hasFriendsActivity:function(){return DOM.scry(this.ndContentContainer,'div.fbFriendsActivity')[0].childNodes.length>0;},hasContent:function(){return DOM.scry(this.ndTop,this.sOverflowItemsSelector).length>0;},getEmptyMessage:function(){return DOM.find(this.ndContentContainer,'div.fbEmptyWidget');},showEmptyMessage:function(){var a=this.getEmptyMessage();if(a)CSS.show(a);}});function RecommendationsWidget(a,b){this.parent.construct(this,a,b);}RecommendationsWidget.extend('ConnectSocialWidget');copy_properties(RecommendationsWidget.prototype,{getLinkType:function(){return ConnectSocialWidget.TYPE_RECOMMENDATIONS;},getPluginType:function(){return this.sActivityParent?ConnectSocialWidget.TYPE_ACTIVITY:ConnectSocialWidget.TYPE_RECOMMENDATIONS;},initializeObject:function(b,d){this.parent.initializeObject.call(this,b,d);this.sActivityParent=b.sActivityParent;this.cropImages();if(this.sActivityParent){var a=Vector2.getElementPosition(this.ndFooter).y-Vector2.getElementPosition(this.ndContentContainer).y,c=copy_properties({},this.oQueryParams);if(a<RecommendationsWidget.ITEM_HEIGHT)return;c.nb_items=Math.round(a/RecommendationsWidget.ITEM_HEIGHT);CSS.setStyle(DOM.scry(this.ndTop,"img.fbLoadImg")[0],'visibility','visible');new AsyncRequest().setURI(RecommendationsWidget.ENDPOINT).setData(c).setReadOnly(true).setErrorHandler(function(){}).setHandler(function(e){ConnectSocialWidget.delayUntilDisplayed(function(){this.onResponse(e);}.bind(this));}.bind(this)).setMethod('GET').send();}},cropImages:function(){var a=DOM.scry(this.ndContentContainer,".fbImageContainer img");if(a.length>0){var b=function(event){RecommendationsWidget.image_resize({image:event.getTarget(),dimension:RecommendationsWidget.IMAGE_HEIGHT});};a.forEach(function(c){if(c.complete){RecommendationsWidget.image_resize({image:c,dimension:RecommendationsWidget.IMAGE_HEIGHT});}else Event.listen(c,'load',b);});}},hasContent:function(){return this.ndContentContainer.childNodes.length>0;},getParent:function(){if(this.sActivityParent)return ConnectSocialWidget.getInstance(this.sActivityParent);},showRecommendationsSeparator:function(){var b=this.getParent();if(b&&b.hasContent()){var a=DOM.scry(this.ndTop,'div.fbRecommendationsSeparator')[0];CSS.show(a);CSS.setStyle(a,'visibility','visible');}return this;},removeOverflowElements:function(){ConnectSocialWidget.prototype.removeOverflowElements.apply(this,arguments);if(this.sActivityParent&&!this.hasContent()){var a=DOM.scry(this.ndTop,'div.fbRecommendationsSeparator')[0];CSS.hide(a);}},onResponse:function(e){DOM.remove(DOM.scry(this.ndTop,"img.fbLoadImg")[0]);var d=e.getPayload();if(d&&d.html){var b=HTML(d.html).getNodes()[0],a=DOM.find(b,'div.fbEmptyWidget'),c=this.getParent();if(a&&c){if(!c.hasContent())c.showEmptyMessage();}else{this.showRecommendationsSeparator();DOM.appendContent(this.ndContentContainer,$A(b.childNodes));this.fRemoveOverflowElements();this.cropImages();animation(this.ndContentContainer).from('opacity',0).to('opacity',1).go();}}}});RecommendationsWidget.ENDPOINT='/ajax/connect/recommendations_widget.php';RecommendationsWidget.IMAGE_HEIGHT=35;RecommendationsWidget.ITEM_HEIGHT=45;function LikeBoxWidget(a,b){this.parent.construct(this,a,b);}LikeBoxWidget.extend('ConnectSocialWidget');copy_properties(LikeBoxWidget.prototype,{getLinkType:function(){return ConnectSocialWdiget.TYPE_LIKEBOX;},getPluginType:function(){return ConnectSocialWidget.TYPE_LIKEBOX;}});RecommendationsWidget.image_resize=function(j){var h=j.image,i=Vector2.getElementDimensions(h),a=i.y,g=i.x,e=j.dimension,k=e+'px';if(a<=5||g<=5)return;var d=a/g;if(d<.5||d>2)return;if(a===g){CSS.setStyle(h,'width',k);}else if(a<g){var c=e/a,b=-Math.round((g-a)*c/2);CSS.setStyle(h,'height',k);CSS.setStyle(h,'marginLeft',b+'px');}else{var c=e/g,f=-Math.round((a-g)*c/2);CSS.setStyle(h,'width',k);CSS.setStyle(h,'marginTop',f+'px');}CSS.setStyle(h,'visibility','visible');CSS.setStyle(h.parentNode,'background','transparent');};ClickThroughMonitor=function(a){copy_properties(this,{ndTop:a.ndTop||document.body,fValidateLink:a.fValidateLink||function(){return true;},fGetMonitorData:a.fGetMonitorData||function(){return {};}});Event.listen(this.ndTop,'mousedown',this.onMouseDown.bind(this));};ClickThroughMonitor.CALL_BACK_SOCIAL_PLUGINS=2;copy_properties(ClickThroughMonitor.prototype,{getMonitoredLink:function(event){var a=event.getTarget(),b=Parent.byTag(a,'a');if(b&&CSS.hasClass(b,'fbMonitor')&&this.fValidateLink(b)){return b;}else return null;},getMonitorData:function(a){var b=this.fGetMonitorData(a);if(document.referrer!=='')b.referrer=document.referrer;b.cb=ClickThroughMonitor.CALL_BACK_SOCIAL_PLUGINS;return b;},onMouseDown:function(event){var a=this.getMonitoredLink(event);if(a)UntrustedLink.bootstrap(a,Env.lhsh,event,this.getMonitorData.bind(this));}});
function GenericPager(){copy_properties(this,{callback:null,hidecallback:null,showcallback:null,max_per_page:10,total:0,currentcount:0,currentpage:0,blocks:[],pagersize:5,pagerlinks:{next:true,last:true,prev:true,first:true}});return this;}copy_properties(GenericPager.prototype,{setCallback:function(a){this.callback=a;return this;},setHideCallback:function(a){this.hidecallback=a;return this;},setShowCallback:function(a){this.showcallback=a;return this;},setDisplayBlocks:function(a){this.blocks=a;return this;},setMaxPerPage:function(a){this.max_per_page=a;return this;},setTotal:function(a){this.total=a;return this;},setPagerSize:function(a){this.pagersize=a;return this;},setLinks:function(a){this.pagerlinks=a;return this;},render:function(){for(var a=0;a<this.blocks.length;a++)this._renderBlock(this.blocks[a]);return this;},_renderBlock:function(a){var f=$N('ul',{className:'pagerpro'});var e=Math.ceil(this.total/this.max_per_page);var d=Math.max(0,Math.min(this.currentpage-Math.ceil(this.pagersize/2),e-this.pagersize));if(1==e){this.hidecallback();}else this.showcallback();var b=[];if(this.currentpage!=0){if(this.pagerlinks.first&&(!this.pagerlinks['prev']||this.currentpage!=1))b.push(this._makeLI(_tx("First"),0,false));if(this.pagerlinks.prev)b.push(this._makeLI(_tx("Prev"),this.currentpage-1,false));}for(var c=d;c<Math.min(d+this.pagersize,e);c++)b.push(this._makeLI(c+1,c,c==this.currentpage));if(this.currentpage<e-1){if(this.pagerlinks.next)b.push(this._makeLI(_tx("Next"),this.currentpage+1,false));if(this.pagerlinks.last&&e>d+this.pagersize)b.push(this._makeLI(_tx("Last"),e-1,false));}DOM.setContent(f,b);DOM.setContent(a,f);},_makeLI:function(d,e,b){var c=$N('li',{className:'pagerpro_li'});var a=$N('a',{href:'#',className:'pagerpro_a'});DOM.setContent(c,a);DOM.setContent(a,d);if(b){CSS.addClass(c,"current");Event.listen(a,'click',Event.kill);}else Event.listen(a,'click',this._setPage.bind(this,e));return c;},_setPage:function(a){this.currentpage=a;this.currentcount=this.currentpage*this.max_per_page;this.callback(this.currentpage+1,this.max_per_page);this.render();return false;},reset:function(a){if(!a)a=0;if(this.currentpage!=a){this.currentpage=a;this.currentcount=this.currentpage*this.max_per_page;this.callback(this.currentpage+1,this.max_per_page);this.render();}return this;},resetView:function(){var a=Math.ceil(this.total/this.max_per_page);if(this.currentpage>=a)this.currentpage=Math.max(a-1,0);this.callback(this.currentpage+1,this.max_per_page);this.render();return this;},getCurrentPage:function(){return this.currentpage;}});
function WallKit(b){var a=$(b);WallKit.getServer=function(){return window.FBCommentServer||window.FB&&window.FB.CommentServer;};copy_properties(this,{frameId:b,frame:a,commentsdiv:DOM.find(a,'div.comment_body'),postsdiv:DOM.find(a,'div.wallkit_posts'),subtitles:DOM.scry(a,'div.wallkit_subtitle div.post_counter'),form:DOM.find(a,'form'),loadgif:DOM.find(a,'div.loading_page'),profilepic:DOM.find(a,'div.profile_pic'),captcha:false,hideform:false,latestUpdate:0,settingsopen:false,post_blacklist:{maxct:true,count:true,total:true,post_to_profile:true},tempPosts:{},formdiv:DOM.find(a,'div.wallkit_form')});copy_properties(this,{wallCaptcha:DOM.scry(this.form,'div.wall_captcha')[0],submit:DOM.find(this.form,'.post input[type="submit"]'),text:DOM.find(this.form,'textarea[name="wall_text"]'),postformid:DOM.find(this.form,' input[name="post_form_id"]'),fb_dtsg:DOM.find(this.form,' input[name="fb_dtsg"]'),maxct:DOM.find(this.form,'input[name="maxct"]'),count:DOM.find(this.form,'input[name="count"]'),total:DOM.find(this.form,'input[name="total"]'),xid:DOM.find(this.form,'input[name="xid"]'),reverse:DOM.find(this.form,'input[name="reverse"]'),post_area:DOM.find(this.form,'div.post_area')});var c=DOM.scry(this.form,'div.toggleform');if(c.length>0){this.hideform=true;this.toggleform=c[0];Event.listen(this.toggleform,'click',function(d){CSS.addClass(this.toggleform,'hidden');CSS.removeClass(this.post_area,'hidden');CSS.removeClass(this.profilepic,'hidden');CSS.removeClass(this.text.parentNode,'hidden');CSS.removeClass(this.loadgif,'pic_hidden');this.text.focus();}.bind(this));}Event.listen(this.submit,'click',this.wallPost.bind(this));this.external_wallkit=(DOM.scry(this.form,'input[name="connected"]').length>0);this.post_to_profile=DOM.find(this.form,'div.post_area input[name="post_to_profile"]');if(this.external_wallkit){this.connected=DOM.find(this.form,'input[name="connected"]');this.loggedinuser=DOM.find(this.form,'input[name="loggedin"]');this.userpic=DOM.find(this.form,'img.connected');this.anonpic=DOM.find(this.form,'img.not_connected');this.namelink=DOM.find(this.form,'span.namelink');this.comment_setup=false;this.connecting=false;this.initCommentServer();this.connect_button=DOM.find(a,'div.connect_button_text .connect_button');Event.listen(this.connect_button,'click',function(d){d.kill();try{WallKit.getServer().showConnect();}catch(e){ConnectSocialWidget.login(null,'wallkit');}}.bind(this));this.logout_link=DOM.find(this.form,'div.connected a.logout');Event.listen(this.logout_link,'click',function(d){d.kill();try{WallKit.getServer().logout();}catch(e){var logout_uri=new URI($('real_logout_link').href);logout_uri.addQueryData({next:window.location.href});window.location=logout_uri.toString();}}.bind(this));DOM.insertAfter(DOM.find(this.form,'div.connect_area'),this.wallCaptcha);this.nameinput=DOM.find(this.form,'div.nameemail input[name="name"]');this.emailinput=DOM.find(this.form,'div.nameemail input[name="email"]');Event.listen(this.nameinput,'focus',this.showAnonymousCaptcha.bind(this));Event.listen(this.emailinput,'focus',this.showAnonymousCaptcha.bind(this));Input.setPlaceholder(this.nameinput,this.nameinput.value);Input.setPlaceholder(this.emailinput,this.emailinput.value);}else DOM.insertAfter(this.text,this.wallCaptcha);CSS.hide(this.wallCaptcha);this.pagers=DOM.scry(a,'div.pager');this.pipe=DOM.scry(a,'span.pipe');this.registerLinks(a);this.genericpager=new GenericPager().setCallback(this.showPosts.bind(this)).setHideCallback(function(){this.pagers.map(hide);this.pipe.map(hide);}.bind(this)).setShowCallback(function(){this.pagers.map(show);this.pipe.map(show);}.bind(this)).setDisplayBlocks(this.pagers).setMaxPerPage(parseInt(this.maxct.value)).setTotal(parseInt(this.total.value)).render();if(!(this.external_wallkit))this.genericpager.resetView();}copy_properties(WallKit.prototype,{wallPost:function(event){event.kill();var b=Input.getValue(this.text);if(!b||b==''){animation(this.text).from('background','#ffcccc').to('background','#fff').duration(120).go();return;}var d='/ajax/wallpost_ajax.php';if(this.external_wallkit&&this.connected.value==0){var e=Input.getValue(this.nameinput);var c=Input.getValue(this.emailinput);if(!e||e==''){animation(this.nameinput).from('background','#ffcccc').to('background','#fff').duration(120).go();return;}d='/ajax/wallkit_anonpost.php';}this.genericpager.reset();this.submit.disabled=true;CSS.addClass(this.submit,'inputsubmit-disabled');show(this.loadgif);var a=this.getFormVars();a.wall_text=b;if(this.post_to_profile.checked)a.feed_story=1;if(this.external_wallkit&&this.connected.value==0){a.name=e;a.email=c;}if(this.captcha){this.text.disabled=false;this.captcha=false;if(!this.external_wallkit||this.connected.value)CSS.hide(this.wallCaptcha);}new AsyncRequest().setURI(d).setHandler(this.onDone.bind(this)).setErrorHandler(function(f){AsyncResponse.defaultErrorHandler(f);this.submit.disabled=false;CSS.removeClass(this.submit,'inputsubmit-disabled');hide(this.loadgif);}.bind(this)).setData(a).send();},setLinks:function(a){this.pagerlinks=a;this.genericpager.setLinks(this.pagerlinks).render();return this;},registerLinks:function(b){if(this.external_wallkit){var d=DOM.scry(b,'a');d.forEach(function(h){h.target='_blank';});}var e=DOM.scry(b,'a.message');e.forEach(this._setMessageHandler.bind(this));var c=DOM.scry(b,'a.delete');c.forEach(this._setDeleteHandler.bind(this));var a=DOM.scry(b,'a.block');a.forEach(this._setBlockHandler.bind(this));var g=DOM.scry(b,'a.unblock');g.forEach(this._setUnblockHandler.bind(this));var f=DOM.scry(b,'a.report');f.forEach(this._setReportHandler.bind(this));},initCommentServer:function(){try{if(!this.comment_setup&&WallKit.getServer()&&WallKit.getServer().serverStarted){this.comment_setup=true;WallKit.getServer().setupConnect(this.connectUser.bind(this),this.logoutUser.bind(this));}else this.initCommentServer.bind(this).defer(100);}catch(a){}},connectUser:function(){if(!this.connected.value){this.connected.value=1;CSS.hide(this.wallCaptcha);this.captcha=false;if(!this.connecting){var a=this.getFormVars();this.connecting=true;new AsyncRequest().setURI('/ajax/wallkit_connect.php').setData(a).setHandler(function(d){var b=DOM.find(this.form,'div.show_not_connected');CSS.removeClass(b,'show_not_connected');CSS.addClass(b,'show_connected');var c=d.getPayload();this.loggedinuser.value=c.user;this.userpic.src=c.picture;this.postformid.value=c.post_form_id;this.fb_dtsg.value=c.fb_dtsg;DOM.setContent(this.namelink,HTML(c.namelink));this.registerLinks(this.namelink);this.showEditSettings(c.editsettings);this.genericpager.resetView();this.connecting=false;}.bind(this)).send();}}},logoutUser:function(){if(this.connected.value){this.connected.value='';var b=DOM.find(this.form,'div.show_connected');CSS.removeClass(b,'show_connected');CSS.addClass(b,'show_not_connected');this.loggedinuser.value=0;var a=this.getFormVars();a.logout=true;new AsyncRequest().setURI('/ajax/wallkit_connect.php').setData(a).setHandler(function(d){var c=d.getPayload();this.postformid.value=c.post_form_id;this.fb_dtsg.value=c.fb_dtsg;this.genericpager.resetView();success=false;this.showEditSettings(c.editsettings);DOM.setContent(this.wallCaptcha,HTML(c.captchaCode));Event.listen(DOM.find(this.form,'div.nameemail'),'click',this.showAnonymousCaptcha.bind(this));CSS.hide(this.wallCaptcha);}.bind(this)).send();}},showAnonymousCaptcha:function(event){if(!this.captcha){this.captcha=true;animation(this.wallCaptcha).show().from('opacity',0).to('opacity',1).duration(200).go();}},_setMessageHandler:function(a){var c=new URI(a.href).getQueryData();var b='/ajax/messaging/composer.php?id='+c.id;Event.listen(a,'click',function(){new Dialog().setAsync(new AsyncRequest().setURI(b)).show();return false;});return false;},_setDeleteHandler:function(a){var b=new URI(a.href).getQueryData();Event.listen(a,'click',function(event){var c=new Dialog().setTitle(_tx("Delete Post")).setBody(_tx("Are you sure you want to delete this post?")).setButtons([Dialog.newButton('delete',_tx("Delete")),Dialog.CANCEL]).setHandler(function(event){var d=b;d[this.postformid.name]=this.postformid.value;d.fb_dtsg=this.fb_dtsg.value;new AsyncRequest().setURI('/ajax/wallkit_edit.php').setHandler(this._deletePost.bind(this,b.cdel)).setData(d).send();}.bind(this)).show();return false;}.bind(this));},_setBlockHandler:function(a){var b=new URI(a.href).getQueryData();Event.listen(a,'click',function(event){var c=new Dialog().setTitle(_tx("Block user?")).setBody(_tx("Are you sure you want to block this user?")).setButtons([Dialog.newButton('block',_tx("Block")),Dialog.CANCEL]).setHandler(function(event){var d=b;d[this.postformid.name]=this.postformid.value;d.fb_dtsg=this.fb_dtsg.value;new AsyncRequest().setURI('/ajax/wallkit_edit.php').setHandler(this.genericpager.resetView.bind(this.genericpager)).setData(d).send();}.bind(this)).show();return false;}.bind(this));},_setUnblockHandler:function(a){var b=new URI(a.href).getQueryData();Event.listen(a,'click',function(event){var c=b;c[this.postformid.name]=this.postformid.value;c.fb_dtsg=this.fb_dtsg.value;new AsyncRequest().setURI('/ajax/wallkit_edit.php').setHandler(this.genericpager.resetView.bind(this.genericpager)).setData(c).send();event.kill();}.bind(this));},_setReportHandler:function(a){Event.listen(a,'click',function(){new Dialog().setAsync(new AsyncRequest().setURI(new URI(a.href))).show();return false;});return false;},_deletePost:function(a,b){this.total.value=parseInt(this.total.value)-1;this.genericpager.setTotal(this.total.value);this.genericpager.resetView();},showEditSettings:function(a){var d=DOM.scry(this.form,'a.editsettings');d.forEach(function(e){DOM.remove(e);});if(!a)return this;if(a.blacklisted){CSS.addClass(DOM.find(this.form,'div.text_spacer'),'hidden');}else CSS.removeClass(DOM.find(this.form,'div.text_spacer'),'hidden');if(a.can_post){CSS.removeClass(DOM.find(this.form,'div.post_area'),'hidden');}else CSS.addClass(DOM.find(this.form,'div.post_area'),'hidden');if(a.allow_anon){CSS.removeClass(DOM.find(this.form,'div.nameemail'),'hidden');CSS.removeClass(DOM.find(this.form,'div.or'),'hidden');CSS.addClass(DOM.find(this.form,'div.hint_text'),'anon');}else{CSS.addClass(DOM.find(this.form,'div.nameemail'),'hidden');CSS.addClass(DOM.find(this.form,'div.or'),'hidden');CSS.removeClass(DOM.find(this.form,'div.hint_text'),'anon');}var c='';if(a.is_admin){c=_tx("Administer Comments");}else if(a.id_mod){c=_tx("Moderate Comments");}else return this;var b=$N('a',{className:'editsettings'},c);Event.listen(b,'click',function(f){var e=this.getFormVars();if(!this.settingsopen){new AsyncRequest().setURI('/ajax/widget_settings.php').setHandler(this._editSettingsHandler.bind(this)).setData(e).send();show(this.loadgif);this.settingsopen=true;}f.kill();}.bind(this));DOM.insertAfter(DOM.find(this.form,'div.composer'),b);return this;},_editSettingsHandler:function(c){hide(this.loadgif);var b=c.getPayload();var a=$N('div');DOM.setContent(a,HTML(b));hide(this.commentsdiv);DOM.insertAfter(this.commentsdiv,a);Arbiter.subscribe('widgets/settings/'+DOM.find(a,'form').id,function(e,d){if(d.action=='close'){DOM.remove(a);show(this.commentsdiv);this.settingsopen=false;hide(this.loadgif);this.genericpager.resetView();}else if(d.action=='submitting')show(this.loadgif);}.bind(this));},setLatestUpdate:function(a){this.latestUpdate=a;},refreshView:function(){if(this.genericpager.getCurrentPage()==0){var b=DOM.scry(this.postsdiv,'span.time');var c=parseInt(this.maxct.value);var a=this.getFormVars();a.page=1;a.pgsize=c;a.start_time=this.latestUpdate;new AsyncRequest().setURI('/ajax/wallkit_get.php').setHandler(this.onRefreshPosts.bind(this)).setErrorHandler(function(){}).setData(a).send();}},onRefreshPosts:function(f){var e=f.getPayload();if(this.genericpager.getCurrentPage()==0&&e){var c=parseInt(this.maxct.value);var d=DOM.scry($N('div',{},HTML(e.posts)),'div.wallkit_post');var a=DOM.scry(this.postsdiv,'div.wallkit_post');if(e.is_delete_update){a.forEach(DOM.remove);a=[];}var g=a.length;for(var b=d.length-1;b>=0;b--){if(this.tempPosts[d[b].id]!=null){this.tempPosts[d[b].id]=null;continue;}animation(d[b]).from('opacity',0).to('opacity',1).go();if(this.reverse.value){DOM.appendContent(this.postsdiv,d[b]);removeTarget=this.postsdiv.firstChild;}else{DOM.prependContent(this.postsdiv,d[b]);removeTarget=this.postsdiv.lastChild;}if(++g>c){DOM.remove(this.postsdiv.lastChild);g--;}this.registerLinks(d[b]);}if(e.total&&e.total!=this.total.value){this.total.value=e.total;this.genericpager.setTotal(this.total.value).render();}this.setLatestUpdate(e.latestUpdate);this.subtitles.forEach(function(h){DOM.setContent(h,HTML(this.getPostCounter(1,parseInt(this.maxct.value),this.total.value)));}.bind(this));}},getFormVars:function(){var c=DOM.scry(this.form,'input');var a={};for(var b=0;b<c.length;b++)if(c[b].name&&!this.post_blacklist[c[b].name])a[c[b].name]=c[b].value;return a;},onDone:function(g){var e=g.getPayload();var h=true;this.submit.disabled=false;CSS.removeClass(this.submit,'inputsubmit-disabled');hide(this.loadgif);if(e.captcha){h=false;DOM.setContent(this.wallCaptcha,HTML(e.captchaCode));this.captcha=true;CSS.show(this.wallCaptcha);}else if(e.wp){var c=$N('div',{},HTML(e.wp)).firstChild;var f=null;animation(c).from('opacity',0).to('opacity',1).go();if(this.reverse.value){DOM.appendContent(this.postsdiv,c);this.registerLinks(this.postsdiv.lastChild);f=this.postsdiv.firstChild;}else{DOM.prependContent(this.postsdiv,c);this.registerLinks(this.postsdiv.firstChild);f=this.postsdiv.lastChild;}this.tempPosts[c.id]=c;var a=parseInt(this.count.value);var i=parseInt(this.total.value);var b=parseInt(this.maxct.value);a++;i++;if(a>b){a=b;DOM.remove(f);}this.count.value=a;this.total.value=i;this.genericpager.setTotal(i).render();this.subtitles.forEach(function(j){DOM.setContent(j,HTML(this.getPostCounter(1,a,i)));}.bind(this));}if(h){if(this.hideform){CSS.removeClass(this.toggleform,'hidden');CSS.addClass(this.post_area,'hidden');CSS.addClass(this.profilepic,'hidden');CSS.addClass(this.text.parentNode,'hidden');CSS.addClass(this.loadgif,'pic_hidden');}if(this.external_wallkit){if(!this.connected.value&&Recaptcha)Recaptcha.reload();try{if(WallKit.getServer().addComment){var comment={post:Input.getValue(this.text),user:e.user};WallKit.getServer().addComment(comment);}}catch(d){}}this.text.value='';this.text.focus();(function(){this.text.blur();}).bind(this).defer(10);}},showPosts:function(b,c){var a=this.getFormVars();a.page=b;a.pgsize=c;show(this.loadgif);new AsyncRequest().setURI('/ajax/wallkit_get.php').setHandler(this.onReplacePosts.bind(this,b,c)).setData(a).send();},onReplacePosts:function(a,c,d){var b=d.getPayload();hide(this.loadgif);DOM.setContent(this.postsdiv,HTML(b.posts));if(b.total&&b.total!=this.total.value){this.total.value=b.total;this.genericpager.setTotal(parseInt(this.total.value)).render();}if(a==1)this.setLatestUpdate(b.latestUpdate);this.subtitles.forEach(function(e){DOM.setContent(e,this.getPostCounter((a-1)*c+1,(a-1)*c+b.numposts,this.total.value));}.bind(this));this.registerLinks(this.postsdiv);},getPostCounter:function(c,a,d){var b='';if(!(d==0))if(c>1||d>a){b=_tx("Displaying {number} of {total-link}.",{number:c+'-'+a,'total-link':_tx("{number} posts",{number:d})});}else if(a==d&&d==2){b=_tx("Displaying the only 2 posts.");}else if(a>=d&&d>1){b=_tx("Displaying all {number} posts.",{number:d});}else if(c==d&&d==1)b=_tx("Displaying the only post.");return b;}});
var FormControl={_gettingCaretPosition:false,getCaretPosition:function(a){a=$(a);if(!DOM.isNode(a,['input','textarea']))return {start:undefined,end:undefined};if(!document.selection)return {start:a.selectionStart,end:a.selectionEnd};if(DOM.isNode(a,'input')){var c=document.selection.createRange();return {start:-c.moveStart('character',-a.value.length),end:-c.moveEnd('character',-a.value.length)};}else{if(!this._gettingCaretPosition){this._gettingCaretPosition=true;a.focus();this._gettingCaretPosition=false;}var c=document.selection.createRange();var d=c.duplicate();d.moveToElementText(a);d.setEndPoint('StartToEnd',c);var b=a.value.length-d.text.length;d.setEndPoint('StartToStart',c);return {start:a.value.length-d.text.length,end:b};}},setCaretPosition:function(c,f,a){c=$(c);if(document.selection){if(c.tagName=='TEXTAREA'){var b=c.value.indexOf("\r",0);while(b!=-1&&b<a){a--;if(b<f)f--;b=c.value.indexOf("\r",b+1);}}var d=c.createTextRange();d.collapse(true);d.moveStart('character',f);if(a!=undefined)d.moveEnd('character',a-f);d.select();}else{c.selectionStart=f;var e=a==undefined?f:a;c.selectionEnd=Math.min(e,c.value.length);c.focus();}}};
function TextInputControl(b){this.parent.construct(this,b);var a=this.getRoot();this.maxLength=a.maxLength||null;var c=function(){this.update.bind(this).defer();}.bind(this);Event.listen(a,{keydown:c,paste:c});}TextInputControl.extend('DOMControl');TextInputControl.prototype={setMaxLength:function(a){var b=this.getRoot();this.maxLength=a;if(a){b.maxLength=a;}else b.removeAttribute('maxlength');return this;},getValue:function(){return Input.getValue(this.getRoot());},isEmpty:function(){return Input.isEmpty(this.getRoot());},setValue:function(a){this.getRoot().value=a;this.update();return this;},clear:function(){return this.setValue('');},setPlaceholderText:function(a){Input.setPlaceholder(this.getRoot(),a);},onupdate:function(){var d=this.getRoot();if(this.maxLength>0)if(d.value.length>this.maxLength){var e=d.value;var c=e.length-this.maxLength;var a=FormControl.getCaretPosition(d);var b=a.end||e.length;d.value=e.substring(0,b-c)+e.substring(b);if(typeof a.start!='undefined')FormControl.setCaretPosition(d,a.start-c,Math.max(a.start,a.end)-c);}}};
function TextAreaControl(a){this.autogrow=false;this.parent.construct(this,a);this.width=null;}TextAreaControl.extend('TextInputControl');TextAreaControl.getWidth=function(b){var a=function(d){return parseInt(CSS.getStyle(b,d),10);};var c=b.offsetWidth-a('paddingLeft')-a('paddingRight')-a('borderLeftWidth')-a('borderRightWidth');if(ua.firefox())c-=2;return Math.max(c,0);};TextAreaControl.prototype={setAutogrow:function(a){this.autogrow=a;return this;},onupdate:function(){this.parent.onupdate();if(this.autogrow){var b=this.getRoot();var c=this.getShadow(b);if(!c)return;CSS.setStyle(c,'width',this._getWidth()+'px');DOM.setContent(c,HTML(htmlize(b.value)+'...'));var a=Math.max(this.minHeight,c.offsetHeight);if(a!=this.height){CSS.setStyle(b,'height',this.isEmpty()?'':a+'px');this.height=a;Arbiter.inform('reflow');}}else if(this.shadow){DOM.remove(this.shadow);this.shadow=null;}},_getWidth:function(){if(this.width===null)this.width=TextAreaControl.getWidth(this.getRoot());return this.width;},getShadow:function(c){if(!this.shadow){var a=CSS.getStyle(c,'fontSize');if(!a)return false;var b=parseInt(CSS.getStyle(c,'height'),10);this.minHeight=b>0?b:c.offsetHeight-8;this.shadow=$N('div',{className:'DOMControl_shadow',style:{wordWrap:'break-word',fontSize:a,fontFamily:CSS.getStyle(c,'fontFamily')}});DOM.getRootElement().appendChild(this.shadow);}return this.shadow;},resetHeight:function(){this.height=-1;this.update();}};
function ContextualDialog(b){var a=new Dialog();copy_properties(a,ContextualDialog.prototype);a._setFromModel(b);return a;}ContextualDialog.prototype={setContext:function(a){this._context=a;this._dirty();return this;},_buildDialogContent:function(){Bootloader.loadComponents('contextual-dialog-css',function(){CSS.addClass(this._obj,'contextual_dialog');this._content=this._frame=$N('div',{className:'contextual_dialog_content'});this._arrow=$N('div',{className:'arrow'});DOM.setContent(this._popup,[this._content,this._arrow]);}.bind(this));},_resetDialogObj:function(){if(!this._context)return;var a=Vector2.getElementPosition(this._context);var c=this._context.offsetWidth,b=this._context.offsetHeight;var d=a.x,e=a.y+b;if(c<64)d+=c/2-32;new Vector2(d,e,'document').setElementPosition(this._popup);},_renderDialog:function(a){if(window!=top)this._auto_focus=false;Dialog.prototype._renderDialog.call(this,a);}};
onloadRegister(function(){Event.listen(document.documentElement,'submit',function(b){var a=b.getTarget().getElementsByTagName('*');for(var c=0;c<a.length;c++)if(a[c].getAttribute('required')&&Input.isEmpty(a[c])){a[c].focus();return false;}},Event.Priority.URGENT);});

if (window.Bootloader) { Bootloader.done(["A5+Dh"]); }