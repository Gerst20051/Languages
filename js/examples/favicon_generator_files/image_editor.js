/* (c) Copyright 2007-2011 Xoron GmbH */
"use strict";var CURSOR_PATH="/images/cursors";var MAX_FRAMES=100;var DEFAULT_DELAY_SECS=1;var DELAY_LIST=[5,10,20,30,40,50,60,70,80,90,100,150,200,300,400,500,600,700,800,900,1000,1100,1200,1300,1400,1500,1600,1700,1800,1900,2000];var LAST_COLOR_FIELDS=6;var CANVAS_REDRAW_INTERVAL=2000;var DROP_ENABLED=0;var TOOL_LIST=["pipette","mover","hotspot","eraser","inverted"];var CURSOR_MOVE_WIDTH=184;var CURSOR_MOVE_DURATION=1000;var CURSOR_MOVE_DELAY=600;var CURSOR_MOVE_HEIGHT=19;var MOVING_CURSOR_TOP=11;var MOVING_CURSOR_LEFT=11;var MOVING_CURSOR_ANIMATION=[{left:(MOVING_CURSOR_LEFT+Math.round(CURSOR_MOVE_WIDTH*2/3)),top:(MOVING_CURSOR_TOP+2*CURSOR_MOVE_HEIGHT),delay:CURSOR_MOVE_DELAY},{left:MOVING_CURSOR_LEFT,top:MOVING_CURSOR_TOP,delay:(CURSOR_MOVE_DELAY*2)},{left:(MOVING_CURSOR_LEFT+CURSOR_MOVE_WIDTH),top:MOVING_CURSOR_TOP,delay:CURSOR_MOVE_DELAY},{left:MOVING_CURSOR_LEFT,top:(MOVING_CURSOR_TOP+CURSOR_MOVE_HEIGHT),delay:(CURSOR_MOVE_DELAY*2)}];var large_box;var small_box;var context;var tool_started;var last_used_colors;var image_changed;var cursor_animation_step;var image_row_count;var image_column_count;var mover_started;var favicon_matrix;var start_mover_row;var start_mover_column;var last_mover_row;var last_mover_column;var moved_image_changed;var canvas_supported;var current_frame;var animation_matrix;var delays;var iterations;var frame_count;var animated_frame;var hotspot_row;var hotspot_column;function initialize_mover(){mover_started=0;start_mover_row=0;start_mover_column=0;last_mover_row=0;last_mover_column=0;moved_image_changed=1;favicon_matrix=[];var a;for(a=1;a<=image_row_count;a++){favicon_matrix[a]=[]}}function initialize_animation(){var c=1;animation_matrix=[];delays=[];if(jQuery("#frame_count")){frame_count=parseInt(jQuery("#frame_count").val(),10);jQuery("#iterations").val(jQuery("#iteration_count").val());var g;for(g=1;g<=frame_count;g++){animation_matrix[g]=[];var f;for(f=1;f<=image_row_count;f++){animation_matrix[g][f]=[];var e="#"+get_pixel_field_name(f,g);if(jQuery(e).length){c=0;var d=jQuery(e).val();var a;for(a=1;a<=image_column_count;a++){if(d.match(/^trans/)){d=d.replace(/^trans/,"");animation_matrix[g][f][a]="trans"}else{if(d.match(/^inv/)){d=d.replace(/^inv/,"");animation_matrix[g][f][a]="inv"}else{if(d.match(/^[\dA-F]{6}/i)){animation_matrix[g][f][a]=d.match(/^[\dA-F]{6}/i);d=d.replace(/^[\dA-F]{6}/i,"")}else{alert("parsing error: "+d)}}}}}else{var b;for(b=1;b<=image_column_count;b++){animation_matrix[g][f][b]="trans"}}}if(jQuery("#delays-f"+g).val()){delays[g]=get_closest(jQuery("#delays-f"+g).val())}else{delays[g]=100*DEFAULT_DELAY_SECS}}}else{initialize_frame(1)}if(animation_allowed()){display_animation_controls();initialize_small_animation()}return(c)}function animation_allowed(){if(jQuery("#animation_frame").length){return(1)}return(0)}function initialize_boxes(){large_box=[];small_box=[];var b;for(b=1;b<=image_row_count;b++){large_box[b]=[];small_box[b]=[];var a;for(a=1;a<=image_column_count;a++){large_box[b][a]=jQuery("#big-r"+b+"c"+a);small_box[b][a]=jQuery("#small-r"+b+"c"+a)}}}function initialize_frame(c){animation_matrix[c]=[];var b;for(b=1;b<=image_row_count;b++){animation_matrix[c][b]=[];var a;for(a=1;a<=image_column_count;a++){animation_matrix[c][b][a]="trans"}}delays[c]=100;frame_count=c}function initialize_last_colors_from_image(){var a=[];var h;for(h=1;h<=image_row_count;h++){var c;for(c=1;c<=image_column_count;c++){var b=animation_matrix[current_frame][h][c];if((b!=="trans")&&(b!=="inv")){if(!a[b]){a[b]=1}else{a[b]++}}}}var g=sort_hash(a,function(j,i){if(a[j]>a[i]){return(-1)}else{if(a[j]<a[i]){return(1)}}return(0)});var e;for(e=0;e<LAST_COLOR_FIELDS+1;e++){if(g[LAST_COLOR_FIELDS+1-e]){var f=g[LAST_COLOR_FIELDS+1-e].key;last_used_colors[0]=f;change_last_used_colors()}}if(g[0]){var d=g[0].key;set_hex_color(d);last_used_colors[0]=d}}function initialize_last_colors(){last_used_colors=[];var a;for(a=0;a<LAST_COLOR_FIELDS+1;a++){last_used_colors[a]="trans"}}function sort_hash(b,d){var c=[];var a;for(a in b){if(b.hasOwnProperty(a)){c.push({key:a,value:b[a]})}}c.sort(function(e,f){return d(e.key,f.key)});return c}function mouse_down_on_icon(a){if(a.which===1){tool_started=1;change_color(a);return(false)}else{if(a.which===3){tool_started=2;change_color(a,1);return(false)}}return(true)}function mouse_up_on_icon(){tool_started=0;if(jQuery("#mover").prop("checked")){mover_started=0}return(false)}function mouse_move_on_icon(a){if(tool_started===1){change_color(a)}else{if(tool_started===2){change_color(a,1)}}return(false)}function mouse_up_on_body(){tool_started=0;if(jQuery("#mover").prop("checked")){mover_started=0}return}function change_color(d,c){if(!/big-r\d+c\d+/.test(d.currentTarget.id)){return(true)}var b=d.currentTarget.id;var f=b.match(/big-r(\d+)c(\d+)/);var e=parseInt(f[1],10);var a=parseInt(f[2],10);if(jQuery("#eraser").prop("checked")||c){process_eraser_clicked_on_table(e,a)}else{if(jQuery("#inverted").prop("checked")||c){process_inverted_clicked_on_table(e,a)}else{if(jQuery("#pipette").prop("checked")){process_pipette_clicked_on_table(e,a)}else{if(jQuery("#mover").prop("checked")){process_mover_clicked_on_table(e,a)}else{if(jQuery("#hotspot").length&&jQuery("#hotspot").prop("checked")){process_hotspot_clicked_on_table(e,a)}else{process_pen_clicked_on_table(e,a)}}}}}}function process_mover_clicked_on_table(g,b){if(!mover_started){mover_started=1;if(moved_image_changed){start_mover_row=g;start_mover_column=b;var e;for(e=1;e<=image_row_count;e++){var a;for(a=1;a<=image_column_count;a++){favicon_matrix[e][a]=animation_matrix[current_frame][e][a]}}moved_image_changed=0}else{start_mover_row=start_mover_row-last_mover_row+g;start_mover_column=start_mover_column-last_mover_column+b}}else{if((last_mover_row!==g)||(last_mover_column!==b)){var d;for(d=1;d<=image_row_count;d++){var f;for(f=1;f<=image_column_count;f++){var c=d+start_mover_row-g;var h=f+start_mover_column-b;if((c>0)&&(c<=image_row_count)&&(h>0)&&(h<=image_column_count)){colorize_field(d,f,favicon_matrix[c][h])}else{colorize_field(d,f,"trans")}}}}}last_mover_row=g;last_mover_column=b}function process_pen_clicked_on_table(c,b){moved_image_changed=1;var a=jQuery("#color_hex_string").text();colorize_field(c,b,a);last_used_colors[0]=a}function process_eraser_clicked_on_table(b,a){moved_image_changed=1;colorize_field(b,a,"trans");last_used_colors[0]="trans"}function process_inverted_clicked_on_table(b,a){moved_image_changed=1;colorize_field(b,a,"inv");last_used_colors[0]="inv"}function colorize_field(c,b,a){colorize_field_in_icons(c,b,a);animation_matrix[current_frame][c][b]=a}function colorize_field_in_icons(c,b,a){if(a==="trans"){large_box[c][b].css("backgroundImage",'url("images/cell_background.png")');if((frame_count===1)||(!jQuery("#animate_preview").prop("checked"))){small_box[c][b].css("backgroundColor","transparent")}if(canvas_supported){context.clearRect(b-1,c-1,1,1)}}else{if(a==="inv"){large_box[c][b].css("backgroundImage",'url("images/cell_inverted.png")');if((frame_count===1)||(!jQuery("#animate_preview").prop("checked"))){small_box[c][b].css("backgroundColor","#000000")}if(canvas_supported){context.fillStyle="#000000";context.fillRect(b-1,c-1,1,1)}}else{large_box[c][b].css("backgroundColor","#"+a);large_box[c][b].css("backgroundImage","");if((frame_count===1)||(!jQuery("#animate_preview").prop("checked"))){small_box[c][b].css("backgroundColor","#"+a)}if(canvas_supported){context.fillStyle="#"+a;context.fillRect(b-1,c-1,1,1)}}}if(!image_changed){image_changed=true;jQuery("#preview_message").fadeOut("slow",function(){jQuery("#cursor_preview").fadeIn("slow")});move_preview_cursor()}}function copy_to_page_favicon(){if(image_changed){var b=jQuery("#page_favicon")[0];var a=b.cloneNode(true);a.setAttribute("href",context.canvas.toDataURL());b.parentNode.replaceChild(a,b)}window.setTimeout(copy_to_page_favicon,CANVAS_REDRAW_INTERVAL)}function process_pipette_clicked_on_table(c,b){moved_image_changed=1;if(animation_matrix[current_frame][c][b]==="trans"){jQuery("#pipette").prop("checked",false);jQuery("#eraser").prop("checked",true)}else{if(animation_matrix[current_frame][c][b]==="inv"){jQuery("#pipette").prop("checked",false);jQuery("#inverted").prop("checked",true)}else{jQuery("#pipette").prop("checked",false);jQuery("#eraser").prop("checked",false);var a=String(animation_matrix[current_frame][c][b]);set_hex_color(a)}}update_after_checkbox_change()}function process_hotspot_clicked_on_table(b,a){tool_started=0;set_hotspot(b-1,a-1)}function get_pixel_field_name(b,a){return("points-r"+b+"f"+a)}function get_x_coordinate(b){var a=0;if(b.pageX){a=b.pageX}else{if(b.clientX){a=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft}}return(a)}function get_y_coordinate(a){var b=0;if(a.pageY){b=a.pageY}else{if(a.clientY){b=a.clientY+document.body.scrollTop+document.documentElement.scrollTop}}return(b)}function tool_checked(a){if(jQuery("#"+a).prop("checked")){deselect_other_tools(a)}update_after_checkbox_change();if((a==="eraser")||(a==="inverted")){change_last_used_colors()}}function deselect_other_tools(a){var b;for(b=0;b<TOOL_LIST.length;b++){if(TOOL_LIST[b]!==a){if(jQuery("#"+TOOL_LIST[b]).length){jQuery("#"+TOOL_LIST[b]).prop("checked",false)}}}}function tool_clicked(a){if(jQuery("#"+a).prop("checked")){jQuery("#"+a).prop("checked",false)}else{jQuery("#"+a).prop("checked",true)}tool_checked(a)}function pen_selected(){deselect_other_tools("pen");update_after_checkbox_change()}function update_after_checkbox_change(){if(jQuery("#pipette").prop("checked")){jQuery("#big_icon").css("cursor",'url("'+CURSOR_PATH+'/pipette.cur"), pointer');jQuery(".big_icon_element").addClass("big_icon_element_hover")}else{if(jQuery("#mover").prop("checked")){jQuery("#big_icon").css("cursor",'url("'+CURSOR_PATH+'/mover.cur"), pointer');jQuery(".big_icon_element").removeClass("big_icon_element_hover")}else{if(jQuery("#hotspot").length&&jQuery("#hotspot").prop("checked")){jQuery("#big_icon").css("cursor",'url("'+CURSOR_PATH+'/hotspot.cur"), pointer');jQuery(".big_icon_element").removeClass("big_icon_element_hover")}else{if(jQuery("#eraser").prop("checked")){jQuery("#big_icon").css("cursor",'url("'+CURSOR_PATH+'/eraser.cur"), pointer');jQuery(".big_icon_element").addClass("big_icon_element_hover")}else{if(jQuery("#inverted").prop("checked")){jQuery("#big_icon").css("cursor",'url("'+CURSOR_PATH+'/inverted.cur"), pointer');jQuery(".big_icon_element").addClass("big_icon_element_hover")}else{jQuery("#big_icon").css("cursor",'url("'+CURSOR_PATH+'/pen.cur"), pointer');jQuery(".big_icon_element").addClass("big_icon_element_hover")}}}}}if(jQuery("#eraser").prop("checked")){jQuery("#big_current_color_box").css("backgroundImage",'url("images/cell_background.png")')}else{if(jQuery("#inverted").prop("checked")){jQuery("#big_current_color_box").css("backgroundImage",'url("images/cell_inverted.png")')}else{jQuery("#big_current_color_box").css("backgroundImage","")}}}function next_frame(){if(current_frame<MAX_FRAMES){current_frame++}if(current_frame>frame_count){current_frame=1}write_hidden_fields_to_tables()}function previous_frame(){current_frame--;if(current_frame<1){if(parseInt(jQuery("#iterations").val(),10)!==1){current_frame=frame_count}else{current_frame=1}}write_hidden_fields_to_tables()}function write_hidden_fields_to_tables(d){jQuery("#frame_no").text(current_frame);jQuery("#frame_count_display").text(frame_count);display_animation_controls();var c=false;if(!d){var e;for(e=1;e<=image_row_count;e++){var b;for(b=1;b<=image_column_count;b++){var a=animation_matrix[current_frame][e][b];if(((e>16)||(b>16))&&(a!=="trans")&&(jQuery("#link_bigger").css("display")!=="none")){c=true}colorize_field_in_icons(e,b,a)}}}if(c){toggle_bigger_drawing(true,0)}}function write_hidden_fields(){jQuery("#hidden_fields").empty();append_hidden_field("hidden_fields","frame_count",frame_count);if(animation_allowed()){append_hidden_field("hidden_fields","iter_count",jQuery("#iterations").val())}else{append_hidden_field("hidden_fields","iter_count",1)}var d;for(d=1;d<=frame_count;d++){var c;for(c=1;c<=image_row_count;c++){var b="";var a;for(a=1;a<=image_column_count;a++){b+=animation_matrix[d][c][a]}append_hidden_field("hidden_fields",get_pixel_field_name(c,d),b)}append_hidden_field("hidden_fields","delays-f"+d,delays[d])}if(hotspot_row){append_hidden_field("hidden_fields","hotspot_row",hotspot_row);append_hidden_field("hidden_fields","hotspot_column",hotspot_column)}}function append_hidden_field(a,b,c){jQuery("#"+a).append('<input type="hidden" name="'+b+'" value="'+c+'">')}function download_icon(){jQuery("#action_flag").val("download_icon");write_hidden_fields();jQuery("#download_icon").submit();return(false)}function download_cursor(){jQuery("#action_flag").val("download_cursor");write_hidden_fields();jQuery("#download_icon").submit();return(false)}function publish_icon(){jQuery("#action_flag").val("publish_request");write_hidden_fields();jQuery("#download_icon").submit();return(false)}function frame_duration_changed(){delays[current_frame]=jQuery("#frame_duration option:selected").val();return(true)}function display_animation_controls(){if(frame_count>current_frame){jQuery("#animation_next_text").text("Next");jQuery("#animation_next_arrow").css("display","inline");jQuery("#loop_next").css("display","none")}else{if(frame_count===current_frame){if((parseInt(jQuery("#iterations").val(),10)!==1)&&(frame_count!==1)){jQuery("#animation_next_text").text("First");jQuery("#animation_next_arrow").css("display","inline");jQuery("#loop_next").css("display","inline")}else{jQuery("#animation_next_arrow").css("display","none")}}}if(current_frame>1){jQuery("#animation_previous_text").text("Previous");jQuery("#animation_previous_arrow").css("display","inline");jQuery("#loop_previous").css("display","none")}else{if((parseInt(jQuery("#iterations").val(),10)===1)||(frame_count===1)){jQuery("#animation_previous_arrow").css("display","none")}else{jQuery("#animation_previous_text").text("Last");jQuery("#animation_previous_arrow").css("display","inline");jQuery("#loop_previous").css("display","inline")}}jQuery("#frame_duration").val(delays[current_frame]);jQuery("#frame_count_display").text(frame_count);jQuery("#frame_no").text(current_frame)}function toggle_animation_controls(a){if(a){jQuery("#animation_frame").slideDown("slow",function(){jQuery("#animation_link_show").hide();jQuery("#animation_link_hide").show()});display_animation_controls()}else{if(frame_count>1){if(confirm("Do you really want to delete all frames except this one?")){if(current_frame>1){animation_matrix.splice(1,current_frame-1)}if(frame_count>current_frame){animation_matrix.splice(2)}frame_count=1;current_frame=1}else{return}}jQuery("#animation_frame").slideUp("slow",function(){jQuery("#animation_link_hide").hide();jQuery("#animation_link_show").show()})}return}function copy_previous_frame(){if(current_frame>1){var b;for(b=1;b<=image_row_count;b++){var a;for(a=1;a<=image_column_count;a++){colorize_field(b,a,animation_matrix[current_frame-1][b][a])}}}}function clear_frame(){var b;for(b=1;b<=image_row_count;b++){var a;for(a=1;a<=image_column_count;a++){colorize_field(b,a,"trans")}}}function append_new_frame(){frame_count++;initialize_frame(frame_count);delays[frame_count]=delays[current_frame];current_frame=frame_count;clear_frame();display_animation_controls()}function delete_frame(){if(frame_count<2){clear_frame();return}if(confirm("Do you really want to delete this frame?")){frame_count--;animation_matrix.splice(current_frame,1);if(frame_count<current_frame){current_frame=frame_count}var b;for(b=1;b<=image_row_count;b++){var a;for(a=1;a<=image_column_count;a++){colorize_field_in_icons(b,a,animation_matrix[current_frame][b][a])}}display_animation_controls()}}function get_closest(a){var b=DELAY_LIST[0];var c;for(c=0;c<DELAY_LIST.length;c++){if(a>=DELAY_LIST[c]){b=DELAY_LIST[c]}else{if(a<DELAY_LIST[c]){break}}}return(b)}function update_small_animation(){if(jQuery("#animate_preview").prop("checked")){if(animated_frame>frame_count){animated_frame=1}var c;for(c=1;c<=image_row_count;c++){var b;for(b=1;b<=image_column_count;b++){var a=animation_matrix[animated_frame][c][b];if(a==="trans"){small_box[c][b].css("backgroundColor","transparent")}else{if(a==="inv"){small_box[c][b].css("backgroundColor","#000000")}else{small_box[c][b].css("backgroundColor","#"+a)}}}}animated_frame++;window.setTimeout(update_small_animation,delays[animated_frame-1]*10)}}function initialize_small_animation(){animated_frame=1;update_small_animation()}function animate_preview_checked(){if(jQuery("#animate_preview").prop("checked")){animated_frame=1;update_small_animation()}else{write_hidden_fields_to_tables()}}function change_last_used_colors(){var b;for(b=1;b<LAST_COLOR_FIELDS+1;b++){if(last_used_colors[0]===last_used_colors[b]){return}}var c;for(c=LAST_COLOR_FIELDS+1;c>0;c--){last_used_colors[c]=last_used_colors[c-1]}var a;for(a=0;a<LAST_COLOR_FIELDS;a++){if(last_used_colors[a+1]==="trans"){jQuery("#current_color_box_"+a).css("backgroundImage",'url("images/cell_background.png")')}else{if(last_used_colors[a+1]==="inv"){jQuery("#current_color_box_"+a).css("backgroundImage",'url("images/cell_inverted.png")')}else{jQuery("#current_color_box_"+a).css("backgroundImage","");jQuery("#current_color_box_"+a).css("background","#"+last_used_colors[a+1])}}}}function last_color_clicked(b){var a=last_used_colors[b+1];if(a==="trans"){jQuery("#eraser").prop("checked",true);deselect_other_tools("eraser");change_last_used_colors()}else{if(a==="inv"){jQuery("#inverted").prop("checked",true);deselect_other_tools("inverted");change_last_used_colors()}else{deselect_other_tools("pen");set_hex_color(a)}}update_after_checkbox_change()}function current_color_clicked(){if((!jQuery("#eraser").prop("checked")&&(!jQuery("#inverted").prop("checked")))){pen_selected()}}function post_comment(){jQuery("#comments_form").show("slow");jQuery("#comment_link").hide();jQuery("#comments_textarea").focus()}function initialize_page(){if(jQuery("#big_icon").length){initialize_create_page()}else{if(jQuery("#import_form").length){initialize_import_page()}else{if(jQuery("#star").length){initialize_voting_page()}}}}function initialize_import_page(){jQuery("#import_form").submit(import_form_submitted);jQuery.preLoadImages("images/import/activity_indicator.gif")}function import_form_submitted(){jQuery("body").append('<div id="wait_window" style="top: '+get_centered_position_top(200)+"px; left: "+get_centered_position_left(300)+'px;"><p><h1 style="margin: 0 1em;">Uploading...</h1><p/><img src="images/import/activity_indicator.gif" style="margin-top: 40px;" /></div>');return true}function get_centered_position_left(a){if(jQuery(window).width()>a){return Math.round((jQuery(window).width()-a)/2)}return 0}function get_centered_position_top(a){if(jQuery(window).height()>a){return Math.round((jQuery(window).height()-a)/3)}return 0}function dragover(a){a.preventDefault()}function drop(d){var e=d.dataTransfer;var c=e.files;d.preventDefault();var b;for(b=0;b<c.length;b++){var a=c[b];handleFile(a)}}function handleFile(a){var c=/image.*/;if(!a.type.match(c)){return false}var b=new FileReader();b.onloadend=function(){var f=jQuery("#favicon_canvas")[0];var e=f.getContext("2d");var d=document.createElement("img");d.onload=function(){e.drawImage(d,0,0,16,16);var k=e.getImageData(0,0,16,16).data;var l;for(l=1;l<=image_row_count;l++){var h;for(h=1;h<=image_column_count;h++){var j=(l-1)*16*4+(h-1)*4;var g=int2hex(k[j])+int2hex(k[j+1])+int2hex(k[j+2]);colorize_field(l,h,g)}}};d.src=b.result};b.readAsDataURL(a);return true}function initialize_cursor_maker(){if(jQuery("#x_hotspot").length&&jQuery("#y_hotspot").length){set_hotspot(jQuery("#y_hotspot").val(),jQuery("#x_hotspot").val())}else{set_hotspot(0,0)}jQuery("#example1").click(function(){return(false)});jQuery("#example2").click(function(){return(false)});jQuery("#link_bigger").click(function(){toggle_bigger_drawing(true,"slow")});jQuery("#link_smaller").click(function(){toggle_bigger_drawing(false,"slow")})}function toggle_bigger_drawing(a,b){if(a){jQuery("#link_bigger").fadeOut(b,function(){jQuery(".outer_element").show();var c=(20+2)*32;jQuery("#big_icon").css("width",c+"px");jQuery(".tag_cloud").parent().removeClass("large_box").addClass("extra_large_box");jQuery("#link_smaller").fadeIn(b)})}else{jQuery("#link_smaller").fadeOut(b,function(){var c=(20+2)*16;jQuery("#big_icon").css("width",c+"px");jQuery(".outer_element").hide();jQuery(".tag_cloud").parent().removeClass("extra_large_box").addClass("large_box");jQuery("#link_bigger").fadeIn(b)})}return(false)}function move_preview_cursor(){if(!image_changed){return}if(!cursor_animation_step){cursor_animation_step=0}cursor_animation_step++;if(cursor_animation_step>(MOVING_CURSOR_ANIMATION.length-1)){cursor_animation_step=0}jQuery("#moving_cursor").delay(MOVING_CURSOR_ANIMATION[cursor_animation_step].delay).animate({left:(MOVING_CURSOR_ANIMATION[cursor_animation_step].left-hotspot_column)+"px",top:(MOVING_CURSOR_ANIMATION[cursor_animation_step].top-hotspot_row)+"px"},{duration:CURSOR_MOVE_DURATION,complete:move_preview_cursor});if(cursor_animation_step===0){jQuery("#example2").prop("checked",true)}else{if(cursor_animation_step===2){jQuery("#example1").prop("checked",true)}}}function set_hotspot(b,a){hotspot_row=b;hotspot_column=a;jQuery("#hotspot_cross").remove();jQuery('<img src="/images/tools/hotspot.png" id="hotspot_cross" style="height: 16px; width: 16px; position: relative; top: 1px; left: 2px;" alt="" />').prependTo("#big-r"+(parseInt(b,10)+1)+"c"+(parseInt(a,10)+1))}function intialize_image_size(){var b=jQuery("#big_icon").children().length;var a=parseInt(-1/2+Math.sqrt(1/4+b),10);image_row_count=a;image_column_count=a}function initialize_animation_controls(){if(animation_allowed()){frame_duration_changed();if(frame_count>1){toggle_animation_controls(1)}}jQuery("#animation_link_show").click(function(){toggle_animation_controls(1);return(false)});jQuery("#animation_link_hide").click(function(){toggle_animation_controls(0);return(false)})}function initialize_create_page(){intialize_image_size();initialize_last_colors();initialize_color_picker();update_after_checkbox_change();initialize_mover();current_frame=1;tool_started=0;initialize_boxes();var b=initialize_animation();initialize_last_colors_from_image();initialize_animation_controls();if(jQuery("#favicon_canvas").length&&(typeof(jQuery("#favicon_canvas")[0].getContext)==="function")){canvas_supported=1;context=jQuery("#favicon_canvas")[0].getContext("2d")}write_hidden_fields_to_tables(b);var c;for(c=1;c<=image_row_count;c++){var a;for(a=1;a<=image_column_count;a++){large_box[c][a].bind("mousedown",mouse_down_on_icon);large_box[c][a].bind("mousemove",mouse_move_on_icon);large_box[c][a].bind("mouseup",mouse_up_on_icon)}}jQuery(document.body).bind("mouseup",mouse_up_on_body);jQuery("#big_icon").bind("contextmenu",function(){return false});if(canvas_supported){copy_to_page_favicon()}if(jQuery("#hotspot").length){initialize_cursor_maker()}if(DROP_ENABLED){jQuery("body").bind("dragover",dragover);jQuery("body").bind("drop",drop);jQuery.event.props.push("dataTransfer")}}(function(b){var a=[];b.preLoadImages=function(){var d=arguments.length;var e;for(e=d;e--;){var c=document.createElement("img");c.src=arguments[e];a.push(c)}}})(jQuery);$(function(){initialize_page()});