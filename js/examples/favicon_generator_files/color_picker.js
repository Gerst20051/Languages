/* (c) Copyright 2007-2011 Xoron GmbH */
"use strict";var MAX_HUE=360;var MAX_SATURATION=100;var MAX_VALUE=100;var HUE_BOX_HEIGHT=165;var WIDTH_SV_BOX=166;var SV_SLIDER_CENTER=4;var HUE_SLIDER_CENTER=2;var INITIAL_COLOR="0084ff";var mouse_up=1;var slide_hsv;function initialize_color_picker(){print_hue_box();set_hex_color(INITIAL_COLOR)}function print_hue_box(){var b="";for(var a=HUE_BOX_HEIGHT;a>=0;a--){b+='<div style="BACKGROUND: #'+hsv2hex([Math.round((360/HUE_BOX_HEIGHT)*a),100,100])+';"><br /></div>'}jQuery("#hue_box").html(b)}function position2hsv(e,a,f){var d=Math.round((f/a)*e);d=check_boundaries(d,0,e);return(d)}function event_position_in_element(b,d,c){var a=event_position_in_document(b)-d;var e=event_position_in_document(b,1)-c;return([a,e])}function check_boundaries(a,b,c){if(a>c){return(c)}else{if(a<b){return(b)}}return(a)}function draw_sliders(b){var a=Math.round(slide_hsv[1]/MAX_SATURATION*WIDTH_SV_BOX);var d=Math.round(WIDTH_SV_BOX-slide_hsv[2]/MAX_VALUE*WIDTH_SV_BOX);var c=Math.round(HUE_BOX_HEIGHT-slide_hsv[0]/MAX_HUE*HUE_BOX_HEIGHT);jQuery("#saturation_value_slider").css("left",(a-SV_SLIDER_CENTER)+"px");jQuery("#saturation_value_slider").css("top",(d-SV_SLIDER_CENTER)+"px");jQuery("#hue_slider").css("top",(c-HUE_SLIDER_CENTER-5)+"px")}function mouse_action(c,b,f){var g;var d;function e(k){if(!mouse_up){var i=event_position_in_element(k,g,d);if(c=="saturation_value_slider"){var h=check_boundaries(i[0],0,WIDTH_SV_BOX);var l=check_boundaries(i[1],0,WIDTH_SV_BOX);slide_hsv[1]=position2hsv(MAX_SATURATION,WIDTH_SV_BOX,h);slide_hsv[2]=MAX_VALUE-position2hsv(MAX_VALUE,WIDTH_SV_BOX,l);update_new_color()}else{if(c=="hue_slider"){var j=check_boundaries(i[1],0,HUE_BOX_HEIGHT);slide_hsv[0]=MAX_HUE-position2hsv(MAX_HUE,HUE_BOX_HEIGHT,j);update_new_color()}}}}if(mouse_up){mouse_up=0;var a=jQuery("#"+b).offset();g=a.left+10;d=a.top+22;document.onmousemove=e;document.onmouseup=function(){mouse_up=1;document.onmousemove="";document.onmouseup=""};e(f)}pen_selected();return(false)}function color_popup(){var a=window.prompt("Color in hex format:",hsv2hex(slide_hsv));var b=/^[0-9a-f]{6}$/i;if(b.test(a)){set_hex_color(a)}}function set_hex_color(a){slide_hsv=rgb2hsv(hex2rgb(a));update_new_color()}function update_new_color(){jQuery("#sv_box").css("backgroundColor","#"+hsv2hex([slide_hsv[0],100,100]));draw_sliders(slide_hsv);var a=hsv2hex(slide_hsv);jQuery("#color_hex_string").html(a);jQuery("#current_color_box").css("background","#"+a);jQuery("#big_current_color_box").css("background","#"+a);change_last_used_colors();return(a)}function int2hex(a){a=Math.round(Math.min(Math.max(0,a),255));return("0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16))}function rgb2hex(a){return(int2hex(a[0])+int2hex(a[1])+int2hex(a[2]))}function hex2rgb(b){var d=single_hex2int(b.charAt(0))*16+single_hex2int(b.charAt(1));var c=single_hex2int(b.charAt(2))*16+single_hex2int(b.charAt(3));var a=single_hex2int(b.charAt(4))*16+single_hex2int(b.charAt(5));return([d,c,a])}function single_hex2int(a){if((a=="a")||(a=="A")){return(10)}else{if((a=="b")||(a=="B")){return(11)}else{if((a=="c")||(a=="C")){return(12)}else{if((a=="d")||(a=="D")){return(13)}else{if((a=="e")||(a=="E")){return(14)}else{if((a=="f")||(a=="F")){return(15)}else{if((a>=0)&&(a<10)){return(parseInt(a,10))}}}}}}}}function hsv2hex(a){return(rgb2hex(hsv2rgb(a)))}function hsv2rgb(j){var f;var h;var b;var g=j[0]/360;var e=j[1]/100;var d=j[2]/100;if(e>0){if(g>=1){g=0}g=6*g;var i=g-Math.floor(g);var c=Math.round(255*d*(1-e));b=Math.round(255*d*(1-(e*i)));var a=Math.round(255*d*(1-(e*(1-i))));d=Math.round(255*d);switch(Math.floor(g)){case 0:f=d;h=a;b=c;break;case 1:f=b;h=d;b=c;break;case 2:f=c;h=d;b=a;break;case 3:f=c;h=b;b=d;break;case 4:f=a;h=c;b=d;break;case 5:f=d;h=c;b=b;break}return([f?f:0,h?h:0,b?b:0])}else{return([(d=Math.round(d*255)),d,d])}}function rgb2hsv(j){var i=(j[0]/255);var a=(j[1]/255);var d=(j[2]/255);var h=Math.min(i,a,d);var n=Math.max(i,a,d);var k=n-h;var b=n;var m;var e;if(k===0){var g=rgb2hsv(hex2rgb(INITIAL_COLOR));m=g[0]/MAX_HUE;e=0}else{e=k/n;var l=(((n-i)/6)+(k/2))/k;var c=(((n-a)/6)+(k/2))/k;var f=(((n-d)/6)+(k/2))/k;if(i==n){m=f-c}else{if(a==n){m=(1/3)+l-f}else{if(d==n){m=(2/3)+c-l}}}if(m<0){m+=1}if(m>1){m-=1}}return([m*MAX_HUE,e*MAX_SATURATION,b*MAX_VALUE])}function agent(a){return(Math.max(navigator.userAgent.toLowerCase().indexOf(a),0))}function event_position_in_document(b,a){var c=agent("msie")?[event.clientX+document.body.scrollLeft,event.clientY+document.body.scrollTop]:[b.pageX,b.pageY];return(c[zero(a)])}function zero(a){a=parseInt(a,10);return(!isNaN(a)?a:0)};