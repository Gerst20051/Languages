# We test that version increments, and that when dropped version number is
# not reused. Along the way, we make sure UUID is stable;
CREATE SCHEMA version_test;
SELECT SCHEMA_VERSION FROM DATA_DICTIONARY.SCHEMAS WHERE SCHEMA_NAME="version_test";

SELECT SCHEMA_UUID INTO @current_schema_uuid FROM DATA_DICTIONARY.SCHEMAS WHERE SCHEMA_NAME="version_test";

ALTER SCHEMA version_test COLLATE = "utf8_persian_ci";
SELECT SCHEMA_VERSION FROM DATA_DICTIONARY.SCHEMAS WHERE SCHEMA_NAME="version_test";

SELECT COUNT(*) FROM DATA_DICTIONARY.SCHEMAS WHERE SCHEMA_UUID = @current_schema_uuid;

ALTER SCHEMA version_test COLLATE = "utf8_persian_ci";
SELECT SCHEMA_VERSION FROM DATA_DICTIONARY.SCHEMAS WHERE SCHEMA_NAME="version_test";

SELECT COUNT(*) FROM DATA_DICTIONARY.SCHEMAS WHERE SCHEMA_UUID = @current_schema_uuid;

DROP SCHEMA VERSION_test;
SELECT SCHEMA_VERSION FROM DATA_DICTIONARY.SCHEMAS WHERE SCHEMA_NAME="version_test";

CREATE SCHEMA version_test;
SELECT SCHEMA_VERSION FROM DATA_DICTIONARY.SCHEMAS WHERE SCHEMA_NAME="version_test";

# Just make sure UUID is not reused.
SELECT COUNT(*) FROM DATA_DICTIONARY.SCHEMAS WHERE SCHEMA_UUID = @current_schema_uuid;

DROP SCHEMA VERSION_test;
