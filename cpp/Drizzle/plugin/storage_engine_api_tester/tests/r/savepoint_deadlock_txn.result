CREATE TABLE t1 (a int) ENGINE=storage_engine_api_tester;
SELECT SEAPITESTER_ERROR_INJECT(2);
SEAPITESTER_ERROR_INJECT(2)
2
SET AUTOCOMMIT=OFF;
START TRANSACTION;
INSERT INTO t1 VALUES (1);
SAVEPOINT A;
SELECT * FROM DATA_DICTIONARY.USER_DEFINED_SAVEPOINTS;
SAVEPOINT_NAME
A
INSERT INTO t1 VALUES (2);
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction
SELECT * FROM DATA_DICTIONARY.USER_DEFINED_SAVEPOINTS;
SAVEPOINT_NAME
SAVEPOINT A;
SELECT * FROM DATA_DICTIONARY.USER_DEFINED_SAVEPOINTS;
SAVEPOINT_NAME
A
ROLLBACK;
SELECT SEAPITESTER_ERROR_INJECT(0);
SEAPITESTER_ERROR_INJECT(0)
0
commit;
DROP TABLE t1;
