/*1299105212,176820409*/

if (window.CavalryLogger) { CavalryLogger.start_js(["bgnVW"]); }

WindowComm={_callbacks:{},makeHandler:function(a,c){c=c||'opener';var b='f'+(Math.random()*(1<<30)).toString(16).replace('.','');WindowComm._callbacks[b]=a;return new URI('/connect/window_comm.php').setQueryData({_id:b,_relation:c}).getQualifiedURI().toString();},_recv:function(b){var a=new URI(b).getQueryData();WindowComm._callbacks[a._id](a);}};
var PopupResizer={_opts:{allowShrink:true,timeout:100},init:function(a){copy_properties(PopupResizer._opts,a);PopupResizer._resizeCheck.recur(PopupResizer._opts.timeout);},_resizeCheck:function(){var e=Vector2.getViewportDimensions(),a=PopupResizer._getDocumentSize(),c=a.y-e.y,d=a.x-e.x;if(d<0)d=0;if(!PopupResizer._opts.allowShrink&&c<0)c=0;if(c||d)try{window.resizeBy(d,c);if(d)window.moveBy(d/-2,0);}catch(b){}},_getDocumentSize:function(){var a={x:ua.firefox()?document.documentElement.scrollWidth:document.body.scrollWidth,y:document.body.scrollHeight};if(a.x<=0||a.x>document.documentElement.scrollWidth)a.x=document.documentElement.scrollWidth;if(a.y<=0||a.y>document.documentElement.scrollHeight)a.y=document.documentElement.scrollHeight;if(window.Dialog&&Dialog.max_bottom&&Dialog.max_bottom>a.y)a.y=Dialog.max_bottom;return a;},open:function(i,b,j){var f=typeof window.screenX!='undefined'?window.screenX:window.screenLeft,g=typeof window.screenY!='undefined'?window.screenY:window.screenTop,e=typeof window.outerWidth!='undefined'?window.outerWidth:document.body.clientWidth,d=typeof window.outerHeight!='undefined'?window.outerHeight:(document.body.clientHeight-22),c=parseInt(f+((e-j)/2),10),h=parseInt(g+((d-b)/2.5),10),a=('width='+j+',height='+b+',left='+c+',top='+h);return window.open(i,'_blank',a);}};
ConnectLogin={init:function(a){this.appID=a.appID;this.oneClick=a.oneClick;XD.init(a);},login:function(a,c,b){if(this.oneClick&&!c){this._oneClick(a);}else this._openPopup(a,c,b);},logout:function(){XD.send({type:'logout'});},_oneClick:function(a){new AsyncRequest().setURI('/ajax/api/tos.php').setData({app_id:this.appID,grant_perm:1}).setHandler(function(b){ConnectLogin._refreshLoginStatus();a&&a();}).send();},_openPopup:function(c,e,d){d=d||{};var b=WindowComm.makeHandler(function(h){ConnectLogin._closePopup();if(ConnectLogin.appID)ConnectLogin._refreshLoginStatus();c&&c();}),a=WindowComm.makeHandler(function(h){ConnectLogin._closePopup();}),g=new URI('/login.php');g.setQueryData({api_key:this.appID,next:b,channel_url:a,cancel_url:a,req_perms:e,v:'1.0',fbconnect:1,display:'popup'});g.addQueryData(d);var f=this._getSize(d);this._popup=PopupResizer.open(g.toString(),f.height,f.width);},_closePopup:function(){if(this._popup){this._popup.close();this._popup=null;}},_refreshLoginStatus:function(){XD.send({type:'refreshLoginStatus'});},_getSize:function(a){if(a.social_plugin=='registration'){return {width:640,height:370};}else return {width:610,height:280};}};
function SendButton(b){var a=$(b.divID);copy_properties(this,{button:DOM.find(a,'a.btnLink'),channel:b.channel,div:a,divID:b.divID,loggedIn:!!b.userID,nodeImageURL:b.nodeImageURL,nodeTitle:b.nodeTitle,nodeURL:b.nodeURL,nodeSummary:b.nodeSummary,likeButtonLayout:b.likeButtonLayout});this.init();}copy_properties(SendButton.prototype,{init:function(){this.formIsOpen=false;this.formIsShown=false;this.pendingFormShow=false;Arbiter.subscribe('platform/socialplugins/send/sent',function(b,a){if(a.controllerID===this.divID)this.closeForm();}.bind(this),Arbiter.SUBSCRIBE_NEW);Arbiter.subscribe('platform/socialplugins/send/cancel',function(b,a){if(a.controllerID===this.divID)this.hideForm();}.bind(this),Arbiter.SUBSCRIBE_NEW);XD.init({channelUrl:this.channel});Event.listen(this.button,'click',this.toggleFormVisibility.bind(this));},toggleFormVisibility:function(a){if(!this.loggedIn){a.kill();ConnectLogin.login(function(){this.loggedIn=true;}.bind(this));return;}if(!this.formIsOpen){this.openForm();}else if(this.formIsShown){this.hideForm();}else this.showForm();},hideForm:function(){if(this.formIsShown){this.formIsShown=false;XD.send({type:'hideEdgeCommentDialog'});CSS.removeClass(this.div,'fbSendButtonSelected');}},showForm:function(){if(!this.formIsShown){CSS.addClass(this.div,'fbSendButtonSelected');this.formIsShown=true;XD.send({type:'showEdgeCommentDialog'});}},closeForm:function(){if(this.formIsOpen){this.formIsOpen=this.formIsShown=false;XD.send({type:'dismissEdgeCommentDialog'});CSS.removeClass(this.div,'fbSendButtonSelected');}return this;},openForm:function(){if(!this.formIsOpen){CSS.addClass(this.div,'fbSendButtonSelected');this.formIsOpen=this.formIsShown=true;var a={type:'presentEdgeCommentDialog',nodeImageURL:this.nodeImageURL,nodeTitle:this.nodeTitle,nodeURL:this.nodeURL,nodeSummary:this.nodeSummary,controllerID:this.divID,widget_type:'send'};if(this.likeButtonLayout=='button_count'){a.preComputedWidthOffset=100;}else if(this.likeButtonLayout=='box_count')a.preComputedHeightOffset=100;XD.send(a);}return this;}});

if (window.Bootloader) { Bootloader.done(["bgnVW"]); }